
## Poetry 란? 

공식문서: https://python-poetry.org/docs/
source code: https://github.com/python-poetry/poetry

- 파이썬에서 종속성 관리와 패키지를 위한 도구이다. 
- 프로젝트가 종속되어 있는 라이브러리를 선언하고, 설치 및 업데이트 등 관리를 해준다.
- 환경을 깔끔하고 재현 가능하게 유지할 수 있게 해줌 
- 반복적인 설치가 가능하도록 lockfile을 제공한다.  그래서 매번 pip freeze -> requirements.txt를 할 필요가 없어진다. 
- 프로젝트의 python 버전과, 필요한 라이브러리를 pyproject.toml로 관리해줌 
- poetry install 명령으로 모든 의존성을 자동으로 설치한다 
- 별도의 가상 환경을 만들어서 프로젝트별로 독립적인 환경을 보장한다 (venv 명령어 필요 없음)
- 의존성 충돌 해결. 프로젝트에 필요한 라이브러리들의 버전 충돌을 자동으로 해결해 준다. 
- 잠금파일 (poetry.lock): 다른 사람에게 공유할 때 모든 라이브러리의 전확한 버전을 기록한 잠금 파일을 제공하여 환경 구현을 완벽하게 재현 할 수 있게 해줌 
- PEP 518 표준인 pyproject.toml로 프로젝트를 관리하는 것을 도와줌 
	- https://peps.python.org/pep-0518/
- pip 보다 좀 더 똑똑함. 종속성을 그룹에 따라 나눌 수 있음. 
	- 개발에 필요한 종속성: Black, pytest 
	- 실제 배포에 필요한 종속성: fastapi



##  기초 사용법

- 설치 
```
curl -sSL https://install.python-poetry.org | python - <버전> 
```


- 설치 및 버전 확인 

```
poetry --version
```

- 기존 프로젝트에 환경 초기화 및 pyproject.toml 파일 생성:
	```poetry init```
- 새 폴더를 만들고 그 안에서 poetry init을 실행하여 프로젝트 구조를 한 번에 생성
	``` poetry new 프로젝트이름```
	
- 필요한 라이브러리 추가:
	```  poetry add 라이브러리명```	```

	- 의존성 추가 
	- 프로젝트에 필요한 라이브러리를 설치하고 pyproject.toml에 기록하며 
	- poetry.lock 파일 업데이트 
	```poetry add fastapi "unvicorn[standard]"```



- 1안: 가상환경 접속/종료:
``` 
poetry shell (가상환경 진입)
poetry exit (종료, 반드시 수행해야 함)
```

현재 터미널 세션 자체를 가상환경 내부로 진입시킴 
	- 장점: 한번 진입하면 이후의 모든 명령어에 poetry run을 붙일 필요가 없음 
	- 단점: 작업을 마치면 반드시 exit 명령어를 입력해 탈출해야 함. 까먹으면 다른 프로젝트를 엉뚱한 환경에서 실행 할 수도 있음 

- 2안: 가상환경에서 poetry 실행하기 
```
poetry run <명령어> 
```

- 장점: 매번 가상환경에 진입/퇴장할 필요가 없다. 스크립트를 작성하거나 CI/CD 파이프라인에서 사용하기 편리하다 
- 단점: 명령어를 실행할 때마다 앞에 poetry run을 붙여야 한다. 
- 가장 흔하게 사용되는 방식. 가상환경을 수동으로 관리할 필요가 없게 해줌. 





주의사항 

- anaconda가 설치되어 있으면 삭제하거나 끄고 설치해야 함 
- pyenv도 마찬가지로 비활성화 후 설치해야 함 
- brew로 설치하지 말것 (기본 설정값이 다름, ssl 에러 발생)


정리 

| 도구                  | 역할                              |
| ------------------- | ------------------------------- |
| **Poetry**          | 프로젝트 설정 및 패키지 관리                |
| **FastAPI (`app`)** | API 경로, 기능 등 웹 로직 작성 (ASGI 앱)   |
| **Uvicorn**         | FastAPI 코드를 실행하는 웹 서버 (ASGI 서버) |
