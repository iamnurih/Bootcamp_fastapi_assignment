

#### 환경변수 관리

지금까지는 모든 값을 코드 안에 직접 작성했습니다. 하지만 실제 프로젝트에서는 코드에 절대 포함하면 안 되는 민감한 정보들이 있습니다.

- 데이터베이스 접속 비밀번호
    
- 외부 서비스 API 키
    
- 암호화에 사용되는 시크릿 키
    

만약 이런 정보를 코드에 그대로 적어서 GitHub 같은 곳에 올린다면, 모든 사람에게 우리 서비스의 비밀번호를 공개하는 것과 같습니다. 또한, 개발 환경과 실제 배포 환경(서버)의 설정값이 다른 경우가 대부분인데, 그때마다 코드를 수정하는 것은 매우 위험하고 번거롭습니다.

이 문제를 해결하기 위해 **환경 변수(Environment Variables)**를 사용합니다.

---

#### ### 환경 변수와 `.env` 파일

**환경 변수**는 코드 바깥, 즉 코드가 실행되는 환경(내 컴퓨터, 서버 등)에 저장되는 변수입니다. 코드는 실행될 때 이 환경 변수 값을 읽어와서 사용합니다.

개발 환경에서는 이런 환경 변수들을 **`.env`** 라는 파일에 저장해서 편리하게 관리하는 것이 일반적입니다.


실습 1: `.env` 파일 만들기

1. 프로젝트의 최상위 폴더(루트)에 `.env` 라는 이름의 파일을 새로 만드세요. (`main.py`와 같은 위치)
    
2. 파일 안에 아래 내용을 작성하고 저장하세요. `KEY=VALUE` 형식입니다.

```
# .env

APP_NAME="My Awesome API"
DEBUG_MODE=True
DATABASE_URL="mysql://user:password@localhost/dbname"
SECRET_KEY="your-very-secret-key-here"
```

**🚨 가장 중요한 규칙: `.gitignore`에 `.env` 추가하기**

`.env` 파일은 민감 정보를 담고 있으므로, 절대로 Git으로 관리하거나 GitHub에 올리면 안 됩니다. 프로젝트의 `.gitignore` 파일을 열어 맨 아래에 `.env` 한 줄을 꼭 추가해주세요.
```
# .gitignore

# ... 다른 내용 ...

.env
```

#### `python-dotenv`로 `.env` 파일 읽기

파이썬 코드가 `.env` 파일의 존재를 자동으로 알지는 못합니다. `python-dotenv`라는 라이브러리를 사용해서 `.env` 파일의 내용을 읽고, 실제 환경 변수인 것처럼 만들어줘야 합니다.

실습 2: 라이브러리 설치 및 설정 파일 만들기

1. **라이브러리 설치** 터미널에 아래 명령어를 입력하세요.
```
poetry add python-dotenv
```


2. **설정 파일(`config.py`) 만들기** 설정 관련 코드를 `main.py`에서 분리하는 것이 좋은 습관입니다. `main.py`와 같은 위치에 `config.py` 파일을 만들고 아래 내용을 작성하세요.

```
# config.py

from dotenv import load_dotenv
import os

# .env 파일에서 환경 변수를 로드합니다.
load_dotenv()

# os.getenv()를 사용하여 환경 변수 값을 읽어옵니다.
APP_NAME = os.getenv("APP_NAME")
DEBUG_MODE = os.getenv("DEBUG_MODE") == "True" # 문자열 "True"를 bool 타입 True로 변환
DATABASE_URL = os.getenv("DATABASE_URL")
SECRET_KEY = os.getenv("SECRET_KEY")
```

- `load_dotenv()`: 이 함수가 호출되는 순간, `python-dotenv`는 현재 폴더에서 `.env` 파일을 찾아 그 안의 `KEY=VALUE`들을 환경 변수로 로드합니다.
    
- `os.getenv("KEY")`: 파이썬 내장 라이브러리 `os`의 함수입니다. 로드된 환경 변수 중에서 `"KEY"`에 해당하는 값을 읽어옵니다. `.env` 파일에 값이 없으면 `None`을 반환합니다.

실습 3: FastAPI에서 설정 값 사용하기

이제 `main.py`에서 방금 만든 `config.py`를 가져와서 사용해 봅시다.

```
# main.py

from fastapi import FastAPI
from . import config # config.py 파일을 import 합니다.

app = FastAPI()

@app.get("/info/")
def get_info():
    # config 모듈을 통해 환경 변수 값을 사용합니다.
    return {
        "app_name": config.APP_NAME,
        "debug_mode": config.DEBUG_MODE,
        "secret_key_prefix": config.SECRET_KEY[:5] + "..." # 실제 키는 노출하지 않습니다.
    }
```